# Cloud Functions 스케줄러 비용 분석

## 현재 제안: 1시간마다 실행

### 실행 횟수
- 하루: 24회
- 한 달: 약 720회
- 연간: 약 8,760회

### 비용 분석

#### Cloud Functions 호출 비용
- **무료 할당량**: 월 200만 호출
- **현재 사용량**: 월 720회
- **비용**: **$0 (무료 할당량 내)**

#### Firestore 읽기 비용
- **쿼리당 읽기**: 약 1~10건 (처리할 신고가 있는 경우)
- **월 읽기 예상**: 수백~수천 건
- **무료 할당량**: 일 50,000건 읽기
- **비용**: **$0 (무료 할당량 내)**

#### Firestore 쓰기 비용
- **처리당 쓰기**: 약 3~5건 (신고 상태 업데이트, 사용자 정보 업데이트 등)
- **월 쓰기 예상**: 수백~수천 건
- **무료 할당량**: 일 20,000건 쓰기
- **비용**: **$0 (무료 할당량 내)**

### 결론
**1시간마다 실행해도 무료 할당량 내에서 거의 무료입니다.**

---

## 대안 1: 6시간마다 실행 (권장)

### 실행 횟수
- 하루: 4회
- 한 달: 약 120회
- 연간: 약 1,460회

### 장점
- ✅ 24시간 내 조치 보장 (최대 지연: 6시간)
- ✅ 비용: 거의 무료 (무료 할당량 내)
- ✅ 실행 횟수 83% 감소 (720회 → 120회)

### 단점
- ⚠️ 최대 6시간 지연 가능 (하지만 24시간 내 조치는 보장)

### 비용
- **Cloud Functions**: $0 (무료)
- **Firestore**: $0 (무료)
- **총 비용**: **$0**

---

## 대안 2: 12시간마다 실행

### 실행 횟수
- 하루: 2회
- 한 달: 약 60회
- 연간: 약 730회

### 장점
- ✅ 24시간 내 조치 보장 (최대 지연: 12시간)
- ✅ 비용: 거의 무료
- ✅ 실행 횟수 92% 감소 (720회 → 60회)

### 단점
- ⚠️ 최대 12시간 지연 가능

### 비용
- **총 비용**: **$0**

---

## 대안 3: 하루 1회 + 즉시 처리 트리거

### 실행 횟수
- 스케줄러: 하루 1회 (월 30회)
- 트리거: 신고 접수 시 (예상 월 수십~수백 회)

### 작동 방식
1. **심각한 신고**: 신고 접수 시 즉시 자동 처리
2. **일반 신고**: 하루 1회 스케줄러로 처리

### 장점
- ✅ 심각한 신고는 즉시 처리
- ✅ 비용: 거의 무료
- ✅ 실행 횟수 최소화

### 단점
- ⚠️ 구현 복잡도 증가
- ⚠️ 심각한 신고 판단 로직 필요

### 비용
- **총 비용**: **$0**

---

## 권장 사항

### 추천: **대안 1 (6시간마다 실행)**

**이유:**
1. ✅ 24시간 내 조치 보장 (Apple 요구사항 충족)
2. ✅ 비용 효율적 (실행 횟수 83% 감소)
3. ✅ 구현 간단 (스케줄만 변경)
4. ✅ 충분한 처리 속도 (최대 6시간 지연)

### 예상 비용 비교

| 옵션 | 월 실행 횟수 | Cloud Functions | Firestore | 총 비용 |
|------|------------|----------------|-----------|---------|
| 1시간마다 | 720회 | $0 | $0 | **$0** |
| **6시간마다** | **120회** | **$0** | **$0** | **$0** |
| 12시간마다 | 60회 | $0 | $0 | **$0** |
| 하루 1회 | 30회 | $0 | $0 | **$0** |

**결론: 모든 옵션이 무료 할당량 내이므로 비용 차이는 거의 없습니다.**

---

## 추가 고려사항

### 사용량이 증가하는 경우
- 신고가 많아지면 Firestore 읽기/쓰기 비용이 증가할 수 있음
- 하지만 일반적인 앱 규모에서는 무료 할당량 내에서 충분

### 모니터링
- Firebase Console에서 실제 사용량 확인
- 필요시 실행 주기 조정 가능

---

**최종 권장사항**: 6시간마다 실행 (비용 효율적이면서도 24시간 내 조치 보장)


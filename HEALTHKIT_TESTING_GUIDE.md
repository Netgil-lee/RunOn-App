# HealthKit 실제 기기 테스트 가이드

## 🎯 테스트 목표
HealthKit 연동이 실제 기기에서 정상적으로 작동하는지 확인하고, 사용자 경험을 검증합니다.

## 📱 테스트 환경 요구사항

### 필수 조건
- **실제 iOS 기기** (iPhone/iPad)
- **iOS 15.1 이상**
- **개발자 계정** (프로비저닝 프로필 필요)
- **Apple Health 앱** 설치 및 설정 완료

### 권장 조건
- **최신 iOS 버전** (iOS 17+)
- **Apple Watch** (워크아웃 데이터 생성용)
- **다양한 기기** (iPhone, iPad)에서 테스트

## 🔧 테스트 환경 설정

### 1. 개발 환경 준비
```bash
# 프로젝트 디렉토리에서
cd /Users/lee_mac/RunOn-App

# 의존성 설치 확인
npm install

# iOS 의존성 설치
cd ios && pod install && cd ..
```

### 2. Xcode 설정 확인
1. **Xcode에서 프로젝트 열기**
   ```bash
   open ios/RunOn.xcworkspace
   ```

2. **Signing & Capabilities 확인**
   - HealthKit Capability 추가됨
   - 개발자 계정 설정됨
   - Bundle Identifier 고유함

3. **Build Settings 확인**
   - Deployment Target: iOS 15.1+
   - HealthKit.framework 링크됨

### 3. 실제 기기에 앱 설치
```bash
# 개발 빌드로 실제 기기에 설치
npx expo run:ios --device
```

## 🧪 테스트 시나리오

### 시나리오 1: 권한 요청 플로우 테스트

#### 1.1 초기 권한 상태 확인
- [ ] 앱 첫 실행 시 HealthKit 권한 요청 다이얼로그 표시
- [ ] AppIntroScreen에서 "건강데이터 접근" 버튼 동작 확인
- [ ] 권한 거부 시 적절한 안내 메시지 표시

#### 1.2 권한 허용 테스트
- [ ] "허용" 선택 시 HealthKit 권한 요청 성공
- [ ] 권한 상태가 UI에 정확히 반영됨
- [ ] AsyncStorage에 권한 상태 저장됨

#### 1.3 권한 거부 후 재요청 테스트
- [ ] 권한 거부 후 설정에서 권한 허용
- [ ] 앱 재시작 시 권한 상태 정확히 인식
- [ ] SettingsScreen에서 권한 상태 정확히 표시

### 시나리오 2: 데이터 가져오기 테스트

#### 2.1 워크아웃 데이터 확인
- [ ] Apple Health 앱에 러닝 기록이 있는지 확인
- [ ] 다양한 워크아웃 타입 (Running, Walking 등) 확인
- [ ] 최근 7일간의 워크아웃 데이터 존재 확인

#### 2.2 공유 기능 테스트
- [ ] ScheduleScreen에서 "공유하기" 버튼 클릭
- [ ] 매칭되는 워크아웃 찾기 성공
- [ ] 워크아웃 상세 정보 가져오기 성공
- [ ] 공유카드 모달 정상 표시

#### 2.3 데이터 매칭 테스트
- [ ] 모임 시간과 워크아웃 시간 매칭 정확도 확인
- [ ] 30분 이내 워크아웃 매칭 로직 테스트
- [ ] 매칭되는 워크아웃이 없을 때 적절한 메시지 표시

### 시나리오 3: 에러 상황 테스트

#### 3.1 HealthKit 사용 불가 상황
- [ ] iOS 8.0 미만 기기에서 테스트 (시뮬레이터)
- [ ] HealthKit 미지원 기기에서 적절한 에러 메시지 표시
- [ ] 더미 데이터 fallback 동작 확인

#### 3.2 권한 거부 상황
- [ ] 설정에서 HealthKit 권한 완전히 비활성화
- [ ] 앱에서 권한 요청 시 적절한 안내 메시지 표시
- [ ] 설정 앱으로 이동 기능 정상 동작

#### 3.3 데이터 없음 상황
- [ ] Apple Health 앱에 워크아웃 데이터가 없는 경우
- [ ] "러닝 기록 없음" 메시지 정상 표시
- [ ] 더미 데이터 사용 시 정상 동작

## 📊 테스트 체크리스트

### 기본 기능 테스트
- [ ] HealthKit 권한 요청/확인
- [ ] 워크아웃 데이터 가져오기
- [ ] 데이터 매칭 로직
- [ ] 공유 기능 동작

### 에러 처리 테스트
- [ ] 권한 거부 시 처리
- [ ] 데이터 없음 시 처리
- [ ] 네트워크 오류 시 처리
- [ ] HealthKit API 오류 시 처리

### 사용자 경험 테스트
- [ ] 로딩 상태 표시
- [ ] 에러 메시지 명확성
- [ ] 설정 앱 이동 기능
- [ ] 권한 상태 UI 정확성

## 🐛 문제 해결 가이드

### 일반적인 문제들

#### 1. HealthKit 권한 요청이 나타나지 않음
**원인**: Xcode 프로젝트 설정 문제
**해결**: 
- HealthKit Capability 확인
- Bundle Identifier 고유성 확인
- 개발자 계정 설정 확인

#### 2. 권한은 허용했지만 데이터를 가져올 수 없음
**원인**: Apple Health 앱에 데이터 없음
**해결**:
- Apple Health 앱에서 러닝 기록 추가
- Apple Watch로 워크아웃 실행
- 수동으로 워크아웃 데이터 입력

#### 3. 앱이 크래시됨
**원인**: HealthKit API 호출 오류
**해결**:
- try-catch 블록 확인
- 권한 상태 확인 후 API 호출
- 에러 로그 확인

### 디버깅 팁

#### 1. 콘솔 로그 확인
```javascript
// HealthKit 관련 로그 필터링
console.log('🏥 HealthKit:', ...);
console.log('✅ HealthKit:', ...);
console.log('❌ HealthKit:', ...);
```

#### 2. 권한 상태 확인
```javascript
// 권한 상태 상세 확인
const permissionStatus = await appleFitnessService.checkPermissions();
console.log('권한 상태:', permissionStatus);
```

#### 3. 데이터 확인
```javascript
// 워크아웃 데이터 확인
const workouts = await appleFitnessService.getRecentWorkouts();
console.log('워크아웃 데이터:', workouts);
```

## 📝 테스트 결과 기록

### 테스트 일시: ___________
### 테스트 기기: ___________
### iOS 버전: ___________

#### 성공한 테스트
- [ ] 권한 요청 플로우
- [ ] 데이터 가져오기
- [ ] 공유 기능
- [ ] 에러 처리

#### 실패한 테스트
- [ ] 권한 요청 플로우
- [ ] 데이터 가져오기
- [ ] 공유 기능
- [ ] 에러 처리

#### 발견된 문제점
1. ________________
2. ________________
3. ________________

#### 개선 사항
1. ________________
2. ________________
3. ________________

## 🚀 다음 단계

테스트 완료 후:
1. **문제점 수정**: 발견된 문제점들 해결
2. **성능 최적화**: 데이터 로딩 속도 개선
3. **사용자 피드백**: 실제 사용자 테스트 진행
4. **문서화**: 최종 구현 가이드 작성

# 러논 앱 리뉴얼 계획

> **상태**: 상의 단계  
> **작성일**: 2025-01-08  
> **목적**: 홈화면 리뉴얼 및 새로운 '지도' 탭 추가

---

## 📋 리뉴얼 개요

### 현재 상황
- 홈화면에 카카오인라인맵(`HanRiverMap` 컴포넌트)이 포함되어 있음
- 바텀탭 네비게이션: 홈, 모임, 커뮤니티, 프로필 (4개 탭)
- 지도 기능이 홈화면 내부에 임베드되어 있음

### 리뉴얼 목표
1. 홈화면을 더 개인화된 대시보드로 전환
2. 지도 기능을 독립적인 탭으로 분리하여 전체 화면으로 제공
3. 사용자 경험 개선 (자주 사용하는 정보에 빠르게 접근)

---

## 1️⃣ 홈화면 리뉴얼

### 1.1 카카오인라인맵 삭제
- **대상 파일**: `screens/HomeScreen.js`
- **삭제 대상**: 
  - `HanRiverMap` 컴포넌트 import 및 사용 부분
  - `hanRiverMapRef` 관련 코드
  - 지도 관련 핸들러 함수들
- **이유**: 지도 기능은 새로운 '지도' 탭으로 이동

### 1.2 마이 대시보드 구현
**기능 요구사항**:
- **자주 찾아가는 러닝카페 목록**
  - 사용자가 자주 방문한 러닝카페를 추적
  - 방문 횟수 기반으로 정렬
  - 카드 형태로 표시 (이름, 위치, 방문 횟수)
  - 클릭 시 해당 카페 상세 정보 또는 지도로 이동

- **자주 개설하는 모임장소 목록**
  - 사용자가 자주 모임을 개설한 장소 추적
  - 개설 횟수 기반으로 정렬
  - 카드 형태로 표시 (장소명, 개설 횟수, 마지막 개설일)
  - 클릭 시 해당 장소로 지도 이동 또는 모임 생성 화면으로 이동

**구현 고려사항**:
- Firestore에서 사용자 활동 데이터 수집 필요
- `users/{userId}` 문서에 방문 기록 필드 추가 고려
- 또는 별도 컬렉션으로 관리 (`userVisits`, `userMeetingLocations` 등)

### 1.3 신규 입점 카페 목록
**기능 요구사항**:
- 최근에 입점한 러닝카페 목록 표시
- 심플한 카드 형태로 구현
- 카페명, 위치, 입점일 표시
- 클릭 시 카페 상세 정보 또는 지도로 이동

**구현 고려사항**:
- Firestore `cafes` 컬렉션에 `createdAt` 또는 `openedAt` 필드 필요
- 최근 N개월 내 입점한 카페만 필터링
- 정렬: 최신순

---

## 2️⃣ '지도' 탭 - 새로운 기능

### 2.1 바텀탭에 '지도' 탭 추가
- **대상 파일**: `navigation/AppNavigator.js`
- **변경 사항**:
  - `MainTabNavigator`에 새로운 `MapTab` 추가
  - 탭 순서: 홈, **지도**, 모임, 커뮤니티, 프로필 (5개 탭)
  - 아이콘: `map` / `map-outline` (Ionicons)
  - 라벨: "지도"

### 2.2 새로운 MapScreen 생성
- **파일 생성**: `screens/MapScreen.js`
- **기능**:
  - 기존 `HanRiverMap` 컴포넌트의 카카오맵 기능을 전체 화면으로 구현
  - WebView를 사용한 카카오맵 표시
  - 현재 위치 표시
  - 지도 줌/팬 제스처 지원

### 2.3 지도 마커 기능
**마커 종류**:
1. **개설된 모임 - 실제 개설된 장소 마커**
   - 실제로 개설된 러닝 모임의 장소를 마커로 표시
   - 마커 클릭 시 모임 상세 정보 표시 (Bottom Sheet 활용 가능)
   - 모임 정보: 제목, 시간, 참가자 수, 장소명

2. **입점 카페 마커**
   - 러닝카페 위치를 마커로 표시
   - 마커 클릭 시 카페 상세 정보 표시 (Bottom Sheet 활용 가능)
   - 카페 정보: 이름, 주소, 운영시간, 평점 등

**구현 고려사항**:
- `EventContext`에서 `allEvents` 데이터 활용
- Firestore `cafes` 컬렉션에서 카페 위치 데이터 활용
- 마커 클러스터링 고려 (많은 마커가 있을 경우)
- 마커 필터링 기능 (모임만 보기, 카페만 보기, 전체 보기)

---

## 🔧 기술적 고려사항

### 컴포넌트 재사용
- `components/HanRiverMap.js`의 카카오맵 로직을 `MapScreen`에서 재사용
- 또는 `HanRiverMap`을 리팩토링하여 전체 화면 모드 지원

### 데이터 구조
- 사용자 방문 기록: `users/{userId}/visits` 서브컬렉션 또는 배열 필드
- 사용자 모임 개설 기록: `users/{userId}/meetingLocations` 서브컬렉션 또는 배열 필드
- 카페 입점일: `cafes/{cafeId}` 문서에 `openedAt` 필드 추가

### 성능 최적화
- 지도 마커 렌더링 최적화 (가시 영역 내 마커만 표시)
- 대시보드 데이터 캐싱
- 무한 스크롤 또는 페이지네이션 적용

---

## 📝 구현 단계 (예상)

### Phase 1: 홈화면 리뉴얼
1. `HomeScreen.js`에서 `HanRiverMap` 제거
2. 마이 대시보드 컴포넌트 생성 (`components/MyDashboard.js`)
3. 신규 입점 카페 목록 컴포넌트 생성 (`components/NewCafesList.js`)
4. Firestore 데이터 구조 설계 및 구현

### Phase 2: 지도 탭 추가
1. `MapScreen.js` 생성
2. `AppNavigator.js`에 `MapTab` 추가
3. `HanRiverMap` 컴포넌트 리팩토링 또는 재사용
4. 마커 표시 기능 구현

### Phase 3: 통합 및 최적화
1. 데이터 연동 테스트
2. UI/UX 개선
3. 성능 최적화
4. 테스트 및 버그 수정

---

## ❓ 확인 필요 사항

1. **마이 대시보드 데이터 수집**
   - 기존 사용자 데이터에 방문 기록이 있는지?
   - 없으면 언제부터 수집을 시작할지?

2. **카페 입점일 데이터**
   - `cafes` 컬렉션에 입점일 필드가 있는지?
   - 없으면 어떻게 구분할지? (생성일 기준?)

3. **지도 마커 스타일**
   - 모임 마커와 카페 마커의 시각적 구분 방법?
   - 마커 색상, 아이콘 등 디자인 가이드

4. **Bottom Sheet 활용**
   - 지도 탭에서도 Bottom Sheet를 사용할지?
   - 마커 클릭 시 상세 정보를 Bottom Sheet로 표시할지?

---

## 📌 참고 파일

- `screens/HomeScreen.js` - 홈화면 (리뉴얼 대상)
- `components/HanRiverMap.js` - 카카오맵 컴포넌트 (재사용 또는 리팩토링)
- `navigation/AppNavigator.js` - 바텀탭 네비게이션 (지도 탭 추가)
- `contexts/EventContext.js` - 모임 데이터 컨텍스트
- `firestore.rules` - Firestore 보안 규칙 (필요시 수정)

---

**다음 단계**: 상의 후 구체적인 구현 계획 수립 및 시작


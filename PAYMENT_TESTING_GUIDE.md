# 💳 RunOn 앱 결제 시스템 테스트 가이드

## 📋 개요
이 문서는 RunOn 앱의 프리미엄 구독 결제 시스템을 테스트하고 검증하는 방법을 설명합니다.

## 🛠️ 테스트 환경 설정

### 1. **iOS 테스트 환경**
```
1. Apple Developer Program 가입 ($99/년)
2. App Store Connect에서 테스트 계정 생성
3. Xcode에서 테스트 계정으로 로그인
4. TestFlight 또는 개발 빌드로 테스트
```

### 2. **Android 테스트 환경**
```
1. Google Play Console 계정 생성
2. 내부 테스트 트랙 설정
3. 테스트 계정 추가
4. 개발 빌드로 테스트
```

## 🧪 테스트 시나리오

### **기본 결제 플로우 테스트**

#### 1. **프리미엄 화면 접근**
- [ ] 설정 → 프리미엄 메뉴 클릭
- [ ] 프리미엄 화면이 정상적으로 로드되는지 확인
- [ ] 제품 정보가 올바르게 표시되는지 확인
- [ ] 가격 정보가 정확한지 확인

#### 2. **제품 정보 로드 테스트**
- [ ] 앱 시작 시 제품 정보가 자동으로 로드되는지 확인
- [ ] 네트워크 오류 시 적절한 에러 메시지가 표시되는지 확인
- [ ] 제품 정보 로딩 중 로딩 인디케이터가 표시되는지 확인

#### 3. **구매 프로세스 테스트**
- [ ] 구독하기 버튼 클릭 시 구매 다이얼로그가 표시되는지 확인
- [ ] Apple ID/Google 계정 인증이 정상적으로 작동하는지 확인
- [ ] 구매 완료 후 성공 메시지가 표시되는지 확인
- [ ] 구매 실패 시 적절한 에러 메시지가 표시되는지 확인

#### 4. **영수증 검증 테스트**
- [ ] 구매 완료 후 영수증이 서버에서 검증되는지 확인
- [ ] 검증 실패 시 적절한 에러 처리가 되는지 확인
- [ ] 구독 상태가 Firestore에 올바르게 저장되는지 확인

### **구독 관리 테스트**

#### 1. **구독 상태 확인**
- [ ] 구독 활성화 후 앱 재시작 시 상태가 유지되는지 확인
- [ ] 구독 만료 시 자동으로 비활성화되는지 확인
- [ ] 구독 취소 후 상태가 올바르게 업데이트되는지 확인

#### 2. **프리미엄 기능 접근**
- [ ] 구독 활성화 시 프리미엄 기능에 접근할 수 있는지 확인
- [ ] 구독 비활성화 시 프리미엄 기능이 제한되는지 확인
- [ ] 프리미엄 기능 사용 시 적절한 권한 체크가 되는지 확인

### **에러 처리 테스트**

#### 1. **네트워크 오류**
- [ ] 네트워크 연결 없이 구매 시도 시 적절한 에러 메시지 표시
- [ ] 네트워크 복구 후 자동으로 재시도되는지 확인

#### 2. **결제 오류**
- [ ] 결제 취소 시 적절한 메시지 표시
- [ ] 결제 실패 시 재시도 옵션 제공
- [ ] 중복 결제 방지 기능 작동 확인

#### 3. **영수증 검증 오류**
- [ ] 잘못된 영수증 처리
- [ ] 서버 검증 실패 시 클라이언트 처리
- [ ] 검증 지연 시 사용자 경험

## 🔧 개발자 테스트 도구

### **iOS 테스트**
```bash
# Xcode에서 테스트 계정 설정
1. Xcode → Preferences → Accounts
2. Apple ID 추가
3. TestFlight 또는 개발 빌드로 테스트

# 샌드박스 테스트
- App Store Connect에서 샌드박스 테스터 계정 생성
- 테스트 계정으로 로그인하여 구매 테스트
```

### **Android 테스트**
```bash
# Google Play Console 테스트
1. Google Play Console → 테스트 → 내부 테스트
2. 테스트 계정 추가
3. APK 업로드 및 테스트

# 로컬 테스트
- Google Play Billing Library 테스트 모드 사용
- 테스트 제품 ID로 구매 테스트
```

## 📊 모니터링 및 로그

### **결제 관련 로그 확인**
```javascript
// 콘솔에서 확인할 수 있는 로그들
console.log('💳 PaymentService: 초기화 시작');
console.log('🛍️ 제품 정보 로드 시작');
console.log('🛒 구매 요청 시작:', productId);
console.log('🔍 영수증 검증 시작');
console.log('✅ 구매 처리 완료');
```

### **Firestore 데이터 확인**
```javascript
// 사용자 구독 상태 확인
{
  isPremium: true,
  subscriptionType: 'com.runon.app.premium.monthly',
  purchaseDate: '2024-01-01T00:00:00.000Z',
  transactionId: '1000000123456789',
  originalTransactionId: '1000000123456789',
  expiresDate: '2024-02-01T00:00:00.000Z',
  isActive: true
}
```

## 🚨 주의사항

### **보안 고려사항**
1. **영수증 검증**: 반드시 서버에서 수행
2. **공유 비밀번호**: App Store Connect에서 안전하게 관리
3. **사용자 데이터**: 개인정보 보호 규정 준수
4. **결제 정보**: PCI DSS 준수

### **테스트 시 주의점**
1. **실제 결제**: 테스트 환경에서만 수행
2. **테스트 계정**: 실제 사용자 계정과 분리
3. **데이터 정리**: 테스트 후 불필요한 데이터 삭제
4. **로그 관리**: 민감한 정보 로그 출력 금지

## 📈 성능 최적화

### **결제 성능 개선**
1. **제품 정보 캐싱**: 로컬에 제품 정보 저장
2. **영수증 검증 최적화**: 비동기 처리
3. **에러 재시도**: 지수 백오프 알고리즘 적용
4. **사용자 경험**: 로딩 상태 명확히 표시

## 🔄 지속적 개선

### **모니터링 지표**
- 구매 완료율
- 영수증 검증 성공률
- 사용자 구독 유지율
- 에러 발생 빈도

### **A/B 테스트**
- 가격 플랜 테스트
- UI/UX 개선 테스트
- 구독 유도 메시지 테스트

## 📞 지원 및 문의

### **기술 지원**
- 개발팀: dev@runon.app
- 결제 관련 문의: payment@runon.app

### **사용자 지원**
- 고객센터: support@runon.app
- 결제 문의: billing@runon.app

---

**마지막 업데이트**: 2024년 1월
**문서 버전**: 1.0
